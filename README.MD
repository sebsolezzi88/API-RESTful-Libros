# ğŸ“š API RESTful de Libros

Esta es una API RESTful construida en **Node.js** que permite a los usuarios registrarse, iniciar sesiÃ³n y gestionar sus libros personales. Incluye funcionalidades como crear, editar, eliminar libros, calificar y actualizar su estado.

---

## ğŸš€ TecnologÃ­as Utilizadas

- **Node.js**
- **Express**
- **Sequelize** (ORM para bases de datos SQL)
- **JWT (JSON Web Token)** para autenticaciÃ³n
- **bcrypt** para encriptar contraseÃ±as
- **MySQL** como base de datos (puede usarse PostgreSQL o SQLite tambiÃ©n)
- **Jest** para realizar las pruebas

---

## ğŸ” AutenticaciÃ³n

- Los usuarios se registran con username y contraseÃ±a.
- Las contraseÃ±as se almacenan encriptadas con bcrypt.
- Los tokens JWT se utilizan para proteger rutas privadas.

---

## ğŸ“ Endpoints Principales

### Auth (`/api/auth`)

- `POST /register` â†’ Crear una nueva cuenta de usuario o admin
- `POST /login` â†’ Iniciar sesiÃ³n y obtener un token JWT
- `DELETE /delete-account` â†’ Eliminar la cuenta del usuario autenticado

### Libros (`/api/books`)

- `GET /getbooks` â†’ Obtener todos los libros del usuario logueado
- `GET /filtercategory?category=fiction` -> Obtener los libros por una categoria espesifica
- `GET /searchbooks?title=javascript` -> Obtener los libros por un titulo
- `GET /filterbooks?status=read` -> Obtener los libros por su estado (`unread`, `reading`,`read`)
- `GET /stats` -> Obtiene estadistiscas

  **Respuesta de ejemplo:**
  ```json
  {
    "totalBooks": 15,
    "read": 7,
    "reading": 3,
    "unread": 5,
    "averageRating": 8.2
  }
  ```

- `POST /addbook` â†’ Crear un nuevo libro
- `PUT /updatebook/:id` â†’ Editar un libro existente
- `DELETE /deletebook/:id` â†’ Eliminar un libro (solo si lo creÃ³ el usuario o es admin)
- `POST /changebooktatus/:id` â†’ Cambiar estado de lectura (`unread`, `reading`, `read`)
- `POST /changebookrating/:id` â†’ Cambiar calificaciÃ³n (de 0 a 10)

### Admin (`/api/admin`)

- `GET /getallbooks` â†’ Obtener todos los libros registrados y el usuario que los creo
- `GET /getbooks-from-user/:id` â†’ Obtener todos los libros de un solo usuario
- `DELETE /delete-user` â†’ Elimina a un usuario y todos los libros que creo

---

## âœ… ProtecciÃ³n con Middleware

- `verifyToken`: Verifica si el usuario tiene un token JWT vÃ¡lido
- `isAdmin`: Verifica si el usuario tiene rol `admin`

---

## ğŸ§ª Validaciones

- Estado de lectura debe ser uno de: `unread`, `reading`, `read`
- CalificaciÃ³n debe estar entre 0 y 10 (y debe ser un nÃºmero vÃ¡lido)

---

## ğŸ”§ InstalaciÃ³n

```bash
npm install
```

### Configura el archivo `.env` con:

```env
PORT=3000
DB_HOST=...
DB_NAME=...
DB_USER=...
DB_PASSWORD=...
JWT_SECRET=...
```

### Corre el servidor:

```bash
npm run dev
```

---

## ğŸ§ª Tests con Jest

Se realizaron pruebas unitarias y de integraciÃ³n utilizando **Jest** para verificar el correcto funcionamiento de los endpoints protegidos y operaciones con libros.

### âœ”ï¸ Funcionalidades probadas:

- AutenticaciÃ³n protegida por token JWT.
- Acceso denegado cuando no se incluye el token.
- Agregado de un libro nuevo con token vÃ¡lido.
- VisualizaciÃ³n de libros existentes autenticados.
- VerificaciÃ³n del contenido de las respuestas (cÃ³digos de estado, mensajes, estructura JSON, etc.).

### ğŸ§¬ Ejecutar pruebas:

```bash
npm test
```

---

## ğŸ“Œ Notas

- Al eliminar un usuario, todos sus libros se eliminan en cascada (`onDelete: 'CASCADE'`).
- JWT se debe enviar en el header: `Authorization: Bearer <token>`

---

> Proyecto hecho con fines educativos y de aprendizaje en desarrollo backend con Node.js
